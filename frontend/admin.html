<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin ‚Äî Control Panel</title>
    <meta
      name="description"
      content="Admin control panel ‚Äî manage users, monitor server health, and review activity logs."
    />
    <meta name="robots" content="noindex, nofollow" />

    <!-- Primary CSS -->
    <link rel="stylesheet" href="static/css/var.css" fetchpriority="high" />
    <link
      rel="stylesheet"
      href="static/css/base/base.light.css"
      fetchpriority="high"
    />
    <link
      rel="stylesheet"
      href="static/css/admin/admin.light.css"
      fetchpriority="high"
    />

    <!-- Synchronous theme detection ‚Äî runs before render to avoid flash -->
    <script>
      (function () {
        var t =
          localStorage.getItem("theme") ||
          (matchMedia("(prefers-color-scheme: dark)").matches
            ? "dark"
            : "light");
        document.documentElement.setAttribute("data-theme", t);
        if (t === "dark") {
          ["base", "admin"].forEach(function (m) {
            var l = document.createElement("link");
            l.rel = "stylesheet";
            l.href = "static/css/" + m + "/" + m + ".dark.css";
            l.fetchPriority = "high";
            document.head.appendChild(l);
          });
        }
        var ld = function (v) {
          var e = document.getElementById("loading");
          if (e) e.style.display = v;
        };
        window.addEventListener("beforeunload", function () {
          ld("flex");
        });
        window.addEventListener("load", function () {
          ld("none");
        });
        window.addEventListener("pageshow", function (e) {
          if (e.persisted) ld("none");
        });
      })();
    </script>

    <!-- Preloads -->
    <link rel="preload" href="static/js/utils/theme.manager.js" as="script" />
    <link
      rel="preload"
      href="static/js/config/platform.config.js"
      as="script"
    />
    <link rel="preload" href="static/js/utils/utils.js" as="script" />
    <link rel="preload" href="non-static/admin/admin.state.js" as="script" />
    <link rel="preload" href="non-static/admin/admin.ui.js" as="script" />
    <link rel="preload" href="non-static/admin/admin.users.js" as="script" />
    <link rel="preload" href="non-static/admin/admin.actions.js" as="script" />
    <link rel="preload" href="non-static/admin/admin.init.js" as="script" />

    <!-- Scripts (deferred ‚Äî execute after HTML is parsed, in order) -->
    <script defer src="static/js/utils/theme.manager.js"></script>
    <script defer src="static/js/config/platform.config.js"></script>
    <script defer src="static/js/utils/utils.js"></script>
    <script defer src="non-static/admin/admin.state.js"></script>
    <script defer src="non-static/admin/admin.ui.js"></script>
    <script defer src="non-static/admin/admin.users.js"></script>
    <script defer src="non-static/admin/admin.actions.js"></script>
    <script defer src="non-static/admin/admin.init.js"></script>
  </head>
  <body>
    <div id="loading">Loading‚Ä¶</div>

    <header class="topbar">
      <a href="/admin" class="topbar-brand">
        <div class="brand-icon"></div>
        ADMIN
      </a>

      <div class="topbar-divider"></div>

      <nav class="topbar-nav">
        <button class="nav-btn active" data-tab="dashboard">Dashboard</button>
        <button class="nav-btn" data-tab="users">Users</button>
        <button class="nav-btn" data-tab="server">Server</button>
        <button class="nav-btn" data-tab="log">Activity Log</button>
      </nav>

      <div class="topbar-right">
        <div class="status-pill">
          <span class="status-dot"></span>
          <span>ONLINE</span>
        </div>
        <span id="clock"></span>
        <button
          class="btn btn-ghost btn-icon btn-sm"
          id="theme-toggle"
          title="Toggle theme"
        >
          <img
            src="static/icons/icons/sun.svg"
            alt="Toggle theme"
            width="18"
            height="18"
          />
        </button>
        <a href="/" class="btn btn-ghost btn-sm">‚Üê App</a>
      </div>
    </header>

    <div class="layout">
      <!-- ‚îÄ‚îÄ Sidebar ‚îÄ‚îÄ -->
      <aside class="sidebar">
        <span class="sidebar-section-label">Actions</span>
        <button class="sidebar-item" data-open-modal="ban-modal">
          <span class="item-icon">‚äò</span> Ban User
        </button>
        <button class="sidebar-item" data-open-modal="unban-modal">
          <span class="item-icon">‚úì</span> Unban User
        </button>
        <button class="sidebar-item" data-open-modal="delete-modal">
          <span class="item-icon">‚úï</span> Delete User
        </button>

        <span class="sidebar-section-label">Navigate</span>
        <button class="sidebar-item" data-tab="dashboard">
          <span class="item-icon">‚óà</span> Dashboard
        </button>
        <button class="sidebar-item" data-tab="users">
          <span class="item-icon">‚äû</span> Users
        </button>
        <button class="sidebar-item" data-tab="server">
          <span class="item-icon">‚öô</span> Server
        </button>
        <button class="sidebar-item" data-tab="log">
          <span class="item-icon">‚åõ</span> Activity Log
        </button>

        <span class="sidebar-section-label">Quick</span>
        <button class="sidebar-item" id="refresh-btn">
          <span class="item-icon">‚Ü∫</span> Refresh All
        </button>
        <button class="sidebar-item" id="reload-users-btn">
          <span class="item-icon">‚äû</span> Reload Users
        </button>
        <a class="sidebar-item" href="/admin/health">
          <span class="item-icon">‚ô•</span> Health Check
        </a>
      </aside>

      <!-- ‚îÄ‚îÄ Main content ‚îÄ‚îÄ -->
      <main class="main">
        <!-- Dashboard tab -->
        <section class="tab-section active" id="tab-dashboard">
          <div class="page-header">
            <div>
              <h1 class="page-title">Dashboard</h1>
              <p class="page-subtitle">
                Overview ‚Äî <span id="dash-ts">loading‚Ä¶</span>
              </p>
            </div>
            <div class="page-actions">
              <button class="btn btn-secondary btn-sm" id="refresh-btn-dash">
                ‚Ü∫ Refresh
              </button>
              <button class="btn btn-amber btn-sm" data-open-modal="ban-modal">
                ‚äò Ban User
              </button>
            </div>
          </div>

          <div class="stat-grid">
            <div class="stat-card c-blue">
              <div class="stat-label">Total Users</div>
              <div class="stat-value" id="stat-total">‚Äî</div>
              <div class="stat-sub">registered accounts</div>
            </div>
            <div class="stat-card c-green">
              <div class="stat-label">Active Sessions</div>
              <div class="stat-value" id="stat-sessions">‚Äî</div>
              <div class="stat-sub">currently online</div>
            </div>
            <div class="stat-card c-red">
              <div class="stat-label">Banned Users</div>
              <div class="stat-value" id="stat-banned">‚Äî</div>
              <div class="stat-sub">access revoked</div>
            </div>
            <div class="stat-card c-amber">
              <div class="stat-label">Max Connections</div>
              <div class="stat-value" id="stat-maxconn">‚Äî</div>
              <div class="stat-sub">server capacity</div>
            </div>
          </div>

          <div class="panel">
            <div class="panel-head">
              <span class="panel-title">‚åõ Recent Activity</span>
              <div class="panel-actions">
                <button class="btn btn-ghost btn-sm" data-tab="log">
                  View all
                </button>
              </div>
            </div>
            <div class="log-scroll" id="recent-log">
              <div class="empty-state">
                <span class="empty-icon">üìã</span>
                Loading activity log‚Ä¶
              </div>
            </div>
          </div>
        </section>

        <!-- Users tab -->
        <section class="tab-section" id="tab-users">
          <div class="page-header">
            <div>
              <h1 class="page-title">User Management</h1>
              <p class="page-subtitle">All registered accounts</p>
            </div>
            <div class="page-actions">
              <button
                class="btn btn-secondary btn-sm"
                id="reload-users-btn-tab"
              >
                ‚Ü∫ Reload
              </button>
              <button class="btn btn-amber btn-sm" data-open-modal="ban-modal">
                ‚äò Ban
              </button>
            </div>
          </div>

          <div class="panel">
            <div class="panel-head">
              <span class="panel-title">‚äû Users</span>
              <div class="panel-actions">
                <input
                  class="form-input"
                  type="text"
                  id="user-search"
                  placeholder="Search by name, email, or ID‚Ä¶"
                  style="
                    width: 220px;
                    padding: var(--space-2) var(--space-3);
                    font-size: var(--text-sm);
                  "
                />
                <select
                  class="form-input"
                  id="status-filter"
                  style="
                    width: 120px;
                    padding: var(--space-2) var(--space-3);
                    font-size: var(--text-sm);
                  "
                >
                  <option value="all">All</option>
                  <option value="active">Active</option>
                  <option value="banned">Banned</option>
                </select>
              </div>
            </div>
            <div class="table-wrap">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>User</th>
                    <th>ID</th>
                    <th>Email</th>
                    <th>Joined</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="user-tbody">
                  <tr>
                    <td colspan="6">
                      <div class="empty-state">
                        <span class="empty-icon">‚äû</span>
                        Loading users‚Ä¶
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- Server tab -->
        <section class="tab-section" id="tab-server">
          <div class="page-header">
            <div>
              <h1 class="page-title">Server Configuration</h1>
              <p class="page-subtitle">Live values from AppState</p>
            </div>
            <div class="page-actions">
              <button class="btn btn-secondary btn-sm" id="reload-stats-btn">
                ‚Ü∫ Refresh
              </button>
            </div>
          </div>

          <div class="server-grid">
            <div class="panel">
              <div class="panel-head">
                <span class="panel-title">‚öô Server</span>
              </div>
              <div class="info-grid" id="server-info">
                <div class="info-row">
                  <span class="info-key">Loading‚Ä¶</span>
                </div>
              </div>
            </div>
            <div class="panel">
              <div class="panel-head">
                <span class="panel-title">üîë Auth</span>
              </div>
              <div class="info-grid" id="auth-info">
                <div class="info-row">
                  <span class="info-key">Loading‚Ä¶</span>
                </div>
              </div>
            </div>
          </div>

          <div class="panel">
            <div class="panel-head">
              <span class="panel-title">‚Ñπ About</span>
            </div>
            <div class="info-grid">
              <div class="info-row">
                <span class="info-key">Version</span>
                <span class="info-val">1.0.0</span>
              </div>
              <div class="info-row">
                <span class="info-key">Platform</span>
                <span class="info-val" id="platform-info">Web</span>
              </div>
            </div>
          </div>
        </section>

        <!-- Activity Log tab -->
        <section class="tab-section" id="tab-log">
          <div class="page-header">
            <div>
              <h1 class="page-title">Activity Log</h1>
              <p class="page-subtitle">Admin actions recorded this session</p>
            </div>
            <div class="page-actions">
              <button class="btn btn-secondary btn-sm" id="clear-log-btn">
                Clear
              </button>
            </div>
          </div>

          <div class="panel">
            <div class="log-scroll" style="max-height: 520px" id="full-log">
              <div class="empty-state">
                <span class="empty-icon">üìã</span>
                No activity recorded yet.
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>

    <!-- ‚îÄ‚îÄ Modal: Ban User ‚îÄ‚îÄ -->
    <div class="modal-backdrop" id="ban-modal">
      <div class="modal">
        <div class="modal-head">
          <span class="modal-title">‚äò Ban User</span>
          <button
            class="modal-close"
            data-close-modal="ban-modal"
            aria-label="Close"
          >
            √ó
          </button>
        </div>
        <div class="modal-body">
          <p>
            Banning a user revokes their access immediately. They will be unable
            to log in or use the service until unbanned.
          </p>
          <div class="form-group">
            <label class="form-label" for="ban-user-id">User ID</label>
            <input
              class="form-input"
              type="number"
              id="ban-user-id"
              placeholder="e.g. 1042"
              min="1"
            />
          </div>
          <div class="form-group">
            <label class="form-label" for="ban-reason">Reason (optional)</label>
            <input
              class="form-input"
              type="text"
              id="ban-reason"
              placeholder="Reason for ban"
            />
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary btn-sm" data-close-modal="ban-modal">
            Cancel
          </button>
          <button class="btn btn-red btn-sm" id="ban-submit-btn">
            ‚äò Confirm Ban
          </button>
        </div>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ Modal: Unban User ‚îÄ‚îÄ -->
    <div class="modal-backdrop" id="unban-modal">
      <div class="modal">
        <div class="modal-head">
          <span class="modal-title">‚úì Unban User</span>
          <button
            class="modal-close"
            data-close-modal="unban-modal"
            aria-label="Close"
          >
            √ó
          </button>
        </div>
        <div class="modal-body">
          <p>Restores full access for the specified user.</p>
          <div class="form-group">
            <label class="form-label" for="unban-user-id">User ID</label>
            <input
              class="form-input"
              type="number"
              id="unban-user-id"
              placeholder="e.g. 1042"
              min="1"
            />
          </div>
        </div>
        <div class="modal-footer">
          <button
            class="btn btn-secondary btn-sm"
            data-close-modal="unban-modal"
          >
            Cancel
          </button>
          <button class="btn btn-green btn-sm" id="unban-submit-btn">
            ‚úì Confirm Unban
          </button>
        </div>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ Modal: Delete User ‚îÄ‚îÄ -->
    <div class="modal-backdrop" id="delete-modal">
      <div class="modal">
        <div class="modal-head">
          <span class="modal-title">‚úï Delete User</span>
          <button
            class="modal-close"
            data-close-modal="delete-modal"
            aria-label="Close"
          >
            √ó
          </button>
        </div>
        <div class="modal-body">
          <p>
            ‚ö† <strong>This action is permanent.</strong> The user's account and
            all associated data will be deleted and cannot be recovered.
          </p>
          <div class="form-group">
            <label class="form-label" for="delete-user-id">User ID</label>
            <input
              class="form-input"
              type="number"
              id="delete-user-id"
              placeholder="e.g. 1042"
              min="1"
            />
          </div>
          <div class="form-group">
            <label class="form-label" for="delete-confirm-text">
              Type <strong>DELETE</strong> to confirm
            </label>
            <input
              class="form-input"
              type="text"
              id="delete-confirm-text"
              placeholder="DELETE"
              autocomplete="off"
            />
          </div>
        </div>
        <div class="modal-footer">
          <button
            class="btn btn-secondary btn-sm"
            data-close-modal="delete-modal"
          >
            Cancel
          </button>
          <button class="btn btn-red btn-sm" id="delete-submit-btn" disabled>
            ‚úï Delete Permanently
          </button>
        </div>
      </div>
    </div>

    <div class="toast-area" id="toast-area"></div>
  </body>
</html>
